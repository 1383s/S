<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>full mark teachers</title>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js"></script>
    
    <script type="module" src="devcheck.js"></script>
    <script src="auth.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            'bg-main': '#020A07',     
            'bg-card': '#0C241C',     
            'accent': '#08402C',      
            'neon-accent': '#27d97e', /* Ø£Ø®Ø¶Ø± Ù†ÙŠÙˆÙ† Ø³Ø§Ø·Ø¹ */
            'glass-border': 'rgba(8, 64, 44, 0.4)', 
            'text-primary': '#E6F0E8', 
          },
          fontFamily: { 
              sans: ['Cairo', 'sans-serif'], 
              tech: ['Orbitron', 'sans-serif']
          }
        }
      }
    }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles for Neon Glow and RTL adjustments */
        body { 
            background-color: var(--bg-main); 
            font-family: 'Cairo', sans-serif;
        }
        .text-neon {
            color: var(--neon-accent);
            text-shadow: 0 0 10px rgba(39, 217, 126, 0.7);
        }
        .border-neon {
            border-color: var(--neon-accent);
        }
        .shadow-neon {
            box-shadow: 0 0 15px rgba(39, 217, 126, 0.6);
        }
        .glow-on-hover:hover {
            box-shadow: 0 0 25px rgba(39, 217, 126, 0.8);
            transform: translateY(-4px);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        /* Mobile adjustment for better readability */
        @media (max-width: 640px) {
            .container-spacing {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
    </style>
</head>
<body class="bg-bg-main min-h-screen text-text-primary">

    <div id="app" class="container mx-auto p-4 md:p-8 container-spacing">

        <a href="subjects.html" class="home-button fixed top-4 right-4 z-50 bg-accent text-white p-2 rounded-lg shadow-lg hover:bg-neon-accent hover:text-bg-main transition duration-300">
            â† Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆØ§Ø¯
        </a>
        
        <h1 class="text-3xl md:text-5xl font-extrabold text-center my-8 font-tech text-neon">
            Ù…ÙØ¹Ù„Ù‘ÙÙ…ÙÙŠ Ù…Ø§Ø¯Ø© <span class="text-white">{{ subjectData.name }}</span>
            <span class="block text-xl md:text-2xl mt-2 text-gray-400">
                ( {{ yearData.name }} )
            </span>
        </h1>

        <div v-if="loading" class="text-center p-10">
            <svg class="animate-spin h-8 w-8 text-neon mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-lg text-neon">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†...</p>
        </div>

        <div v-else class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div 
                v-for="teacher in teachers" 
                :key="teacher.id" 
                @click="selectTeacher(teacher.id)"
                class="bg-bg-card p-6 rounded-xl border border-glass-border shadow-lg transition duration-300 ease-in-out hover:bg-accent glow-on-hover cursor-pointer"
            >
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="flex-shrink-0 w-16 h-16 rounded-full bg-accent border-4 border-neon-accent flex items-center justify-center shadow-neon">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    </div>
                    <div>
                        <p class="text-xl font-bold text-neon">{{ teacher.name }}</p>
                        <p class="text-sm text-gray-400">{{ teacher.description || 'Ù…ÙØ¹Ù„Ù‘Ù… Ø§Ù„Ù…Ø§Ø¯Ø©' }}</p>
                    </div>
                </div>
            </div>
            
            <div v-if="teachers.length === 0" class="col-span-full text-center p-10 bg-bg-card rounded-lg border-2 border-dashed border-neon-accent">
                <p class="text-xl text-warn">âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØ¹Ù„Ù‘Ù…ÙˆÙ† Ù…ØªØ§Ø­ÙˆÙ† Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>
            </div>
        </div>

        <div class="fixed bottom-0 left-0 right-0 p-4 pointer-events-none">
            <div v-for="(toast, index) in toasts" :key="index"
                 :class="['p-4 rounded-lg mb-2 shadow-xl transition-all duration-300 transform translate-y-0', 
                          toast.type === 'success' ? 'bg-neon-accent text-bg-main' : 'bg-red-600 text-white']"
                 style="pointer-events: auto; max-width: 400px; margin-right: auto; margin-left: auto;"
            >
                {{ toast.message }}
            </div>
        </div>
    </div>

<script>
const { createApp, ref, onMounted } = Vue;

// ğŸš¨ ÙƒÙˆÙ†ÙÙŠØ¬ Firebase (Ù†ÙØ³ Ø§Ù„ÙƒÙˆÙ†ÙÙŠØ¬ Ø§Ù„Ù„ÙŠ ÙÙŠ subjects.html)
const firebaseConfig = {
    apiKey: "AIzaSyBK6FZF3LW83qaUHBKYTfiVd2Ozrd1Rf2g",
    authDomain: "thanawy-1383.firebaseapp.com",
    databaseURL: "https://thanawy-1383-default-rtdb.firebaseio.com",
    projectId: "thanawy-1383",
    // ...
};

// ğŸ’¡ ØªÙ‡ÙŠØ¦Ø© Firebase (Ù„Ù„ØªØ£ÙƒØ¯ ÙÙ‚Ø·)
if (typeof firebase === 'undefined' || firebase.apps.length === 0) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.database(); // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ instance

// ğŸŒ ØªØ­Ø¯ÙŠØ¯ Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù€ JSON Ø­Ø³Ø¨ Ø§Ù„Ø´Ø¹Ø¨Ø© (Ø§Ù„Ù€ Logic Ø§Ù„Ø¬Ø¯ÙŠØ¯)
const JSON_URLS = {
    'Ø¹Ù„Ù…ÙŠ Ø¹Ù„ÙˆÙ…': "https://plus-teal.vercel.app/organized_output.json",
    'Ø§Ø¯Ø¨ÙŠ': "https://plus-teal.vercel.app/organized_output-a.json", 
    'Ø¹Ù„Ù…ÙŠ Ø±ÙŠØ§Ø¶Ø©': "https://plus-teal.vercel.app/organized_outputa.json", 
    'Ø§Ø²Ù‡Ø±': "https://plus-teal.vercel.app/organized_outpua.json",
    'DEFAULT': "https://plus-teal.vercel.app/organized_output.json" 
};


// ğŸ”¥ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø´Ø¹Ø¨Ø© ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù€ URL ğŸ”¥
async function getDataSourceURL(showToast) {
    const activeCode = localStorage.getItem('activeCode');
    if (!activeCode) {
        console.warn("No active code found. Redirecting to login.");
        showToast("âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.", "error");
        setTimeout(() => window.location.href = 'index.html', 1500); 
        return JSON_URLS.DEFAULT;
    }

    try {
        const snapshot = await db.ref(`approvedStudents/${activeCode}`).once('value');
        const studentData = snapshot.val();

        if (studentData && studentData.section) {
            const studentSection = studentData.section.trim();
            const url = JSON_URLS[studentSection] || JSON_URLS.DEFAULT;
            showToast(`ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø´Ø¹Ø¨ØªÙƒ: ${studentSection}`, "info");
            return url;
        } else {
            showToast("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´Ø¹Ø¨Ø©. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ.", "warn");
            return JSON_URLS.DEFAULT;
        }
    } catch (error) {
        showToast("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´Ø¹Ø¨Ø©. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ.", "error");
        console.error("Error fetching student section from Firebase:", error);
        return JSON_URLS.DEFAULT;
    }
}


createApp({
    setup() {
        const loading = ref(true);
        const teachers = ref([]);
        const yearData = ref({ name: '' });
        const subjectData = ref({ name: '' });
        const toasts = ref([]);

        // ğŸ’¡ Ø¯Ø§Ù„Ø© Toast Ù…ØµØºØ±Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù€ Vue Component
        const showToast = (message, type = "info") => {
            const id = Date.now();
            toasts.value.push({ id, message, type });
            setTimeout(() => {
                toasts.value = toasts.value.filter(t => t.id !== id);
            }, 3000);
        };
        
        // ğŸ’¡ Ø¬Ù„Ø¨ Ø§Ù„Ù€ IDs Ù…Ù† Ø§Ù„Ù€ URL
        const getUrlParams = () => {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                yid: urlParams.get('yid'), // Year ID
                sid: urlParams.get('sid')  // Subject ID
            };
        };

        const params = getUrlParams();

        const selectTeacher = (teacherId) => {
            // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø´Ø¨Ø§ØªØ± Ù…Ø¹ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù€ IDs
            const url = `chapters.html?yid=${params.yid}&sid=${params.sid}&tid=${teacherId}`;
            window.location.href = url;
        };

        const fetchData = async () => {
            if (!params.yid || !params.sid) {
                loading.value = false;
                showToast("âŒ Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ù†Ø© Ø£Ùˆ Ø§Ù„Ù…Ø§Ø¯Ø© ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·.", "error");
                return;
            }
            
            // ğŸ”¥ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù€ URL Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø´Ø¹Ø¨Ø© ğŸ”¥
            const finalSourceURL = await getDataSourceURL(showToast); 

            try {
                const res = await fetch(finalSourceURL);
                if (!res.ok) throw new Error("Failed to fetch data source");
                const fullData = await res.json();

                // 1. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ù†Ø©
                const year = fullData.find(y => y.id == params.yid);
                if (!year) throw new Error("Year not found");
                yearData.name = year.name; 

                // 2. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø§Ø¯Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù†Ø©
                const subject = year.subjects.find(s => s.id == params.sid);
                if (!subject) throw new Error("Subject not found");
                subjectData.name = subject.name; 
                
                // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¹Ù„Ù‘Ù…ÙŠÙ†
                teachers.value = subject.teachers || [];
                
                showToast(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${teachers.value.length} Ù…ÙØ¹Ù„Ù‘Ù… Ù„Ù…Ø§Ø¯Ø© ${subject.name}.`, "success");

            } catch (err) {
                console.error("Data fetching error:", err);
                showToast(`âš  ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${err.message}`, "error");
            } finally {
                loading.value = false;
            }
        };

        onMounted(fetchData);

        return { loading, teachers, yearData, subjectData, selectTeacher, toasts };
    }
}).mount('#app');
</script>

</body>
</html>
