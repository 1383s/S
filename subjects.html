<!DOCTYPE html>
<html lang="ar" dir="rtl" class="dark">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø§Ù„Ù…ÙˆØ§Ø¯ - Ù…Ù†ØµØ© 1383</title>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
    // ğŸš¨ 1. Configuration - Ù„Ø§Ø²Ù… ØªØ­Ø· Ù†ÙØ³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„ÙŠ ÙÙŠ index.html
    const firebaseConfig = {
      apiKey: "AIzaSyBK6FZF3LW83qaUHBKYTfiVd2Ozrd1Rf2g",
      authDomain: "thanawy-1383.firebaseapp.com",
      databaseURL: "https://thanawy-1383-default-rtdb.firebaseio.com",
      projectId: "thanawy-1383",
      storageBucket: "thanawy-1383.firebasestorage.app",
      messagingSenderId: "1026664406457",
      appId: "1:1026664406457:web:87d71f7e41bef36ba0aa68",
      measurementId: "G-J5R2EFM2D0"
    };

    // ğŸš¨ 2. Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù„ÙŠ Ù‡ØªØ±Ø¬Ø¹ Ù„ÙŠÙ‡Ø§
    const LOGIN_PAGE_URL = "https://1383ss.vercel.app"; 

    // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
    function redirectToLogin(reason) {
        window.location.replace(LOGIN_PAGE_URL);
    }

    // *******************************************************************

    const activeCode = localStorage.getItem('activeCode');
    const localDeviceId = localStorage.getItem('localDeviceId');

    // 3. Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ: Ù„Ùˆ Ù…ÙÙŠØ´ ÙƒÙˆØ¯ Ø£Ùˆ Device ID Ù…ØªØ³Ø¬Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§
    if (!activeCode || !localDeviceId) {
        redirectToLogin("Missing local code or Device ID.");
    } else {
        // 4. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase
        
        if (typeof firebase === 'undefined' || firebase.apps.length === 0) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        async function verifyCodeOnServer(code) {
            try {
                const snapshot = await db.ref('approvedStudents/' + code).once('value');
                const data = snapshot.val();
                const now = Date.now();

                if (!data) {
                    redirectToLogin("Code not found.");
                    return;
                }

                if (data.expiry <= now) {
                    redirectToLogin("Code is expired.");
                    return;
                }
                
                if (data.isBlocked === true) {
                    redirectToLogin("Code is blocked.");
                    return;
                }
                
                const storedDeviceId = data.deviceId;
                
                if (!storedDeviceId || storedDeviceId !== localDeviceId) {
                    localStorage.removeItem('activeCode');
                    localStorage.removeItem('localDeviceId');
                    redirectToLogin("Code linked to another device.");
                    return;
                }

                // âœ… Ø§Ù„ÙƒÙˆØ¯ Ø³Ù„ÙŠÙ… ÙˆÙ…ÙØ¹Ù„ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²
                // Ù†Ø·Ù„Ù‚ Ø­Ø¯Ø« Ø¥Ù† Ø§Ù„ØªØ­Ù‚Ù‚ Ù†Ø¬Ø­ Ø¹Ø´Ø§Ù† ÙƒÙˆØ¯ Ø§Ù„Ù€ Vue.js ÙŠØ´ØªØºÙ„
                window.authPassed = true;
                document.dispatchEvent(new Event("authReady")); 

            } catch (error) {
                // Ù„Ùˆ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ Ø§Ù„Ø£Ù…Ø§Ù† ÙŠÙ‚ØªØ¶ÙŠ Ø¥Ù†Ù†Ø§ Ù†Ø±Ø¬Ø¹Ù‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
                redirectToLogin("Verification server error.");
            }
        }

        verifyCodeOnServer(activeCode);
    }
    
    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø²ÙŠ Ø§Ù„Ù„ÙŠ ÙÙŠ lasti.html
    function getUserData() {
        try {
            const stored = localStorage.getItem("user_data");
            if (stored) {
                return JSON.parse(stored);
            }
        } catch (e) {
            console.error("Error reading user_data from localStorage", e);
        }
        return { name: "Ø§Ù„Ø²Ø§Ø¦Ø±", section: "ØºÙŠØ± Ù…Ø­Ø¯Ø¯" };
    }
</script>

<script src="https://cdn.tailwindcss.com"></script>
<script>
// ğŸŸ¢ ØªØ¹Ø¯ÙŠÙ„ Ø£Ù„ÙˆØ§Ù† Tailwind Ù„ØªØµØ¨Ø­ Ø®Ø¶Ø±Ø§Ø¡ Ø²ÙŠ Ù…Ø§ Ø·Ù„Ø¨Øª
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      colors: {
        primary: '#10b981',      // Emerald Green (Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
        secondary: '#3b82f6',    // Blue (Ù„Ù„ØªÙ†ÙˆØ¹ØŒ ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡)
        dark: '#0f172a',
        darker: '#020617',
        card: '#1e293b',
        'card-hover': '#334155'
      },
      fontFamily: { 
        // ğŸ’¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© Ø¹Ø´Ø§Ù† ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¯ÙŠØ²Ø§ÙŠÙ† Ø§Ù„Ø£ØµÙ„ÙŠ
        sans: ['Cairo', 'sans-serif'] 
      }
    }
  }
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@200..900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<style>
/* ğŸš¨ Ø³ØªØ§ÙŠÙ„Ø§Øª subjects.html Ø§Ù„Ø£ØµÙ„ÙŠØ©ØŒ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù€ Vue/Tailwind */
:root {
  /* ğŸŸ¢ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„Ø£Ø®Ø¶Ø± Ùˆ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„Ù€ Darker */
  --main-color: #10b981; /* Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
  --light-color: #34d399; /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ù„Ù„Ù…Ø³Ø§Øª Ø§Ù„Ù†ÙŠÙˆÙ† */
  --dark-bg: #020617; /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ø¬Ø¯Ø§Ù‹ */
  --darker-bg: #0f172a; /* Ø£ØºÙ…Ù‚ Ù„Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©/Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
  --accent-gold: #ffc300; /* Ù„ÙˆÙ† Ø«Ø§Ù†ÙˆÙŠ Ø°Ù‡Ø¨ÙŠ/Ø£ØµÙØ± ÙØ§ØªØ­ Ù„Ù„ØªÙ…ÙŠØ² */
  --light-text: #f0f0f5;
  --gray-text: #bdc3c7;
}

body {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 90px 15px 70px;
  font-family: 'Cairo', sans-serif;
  background: var(--dark-bg);
  color: var(--light-text);
  margin: 0;
  transition: background 0.4s, color 0.4s;
  overflow-x: hidden;
  /* ğŸ’¡ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø£ØµØ¨Ø­ Ù…Ù‡Ù… Ù„Ù€ Vue/Tailwind */
  height: 100vh;
}

/* ===== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ (Top Bar) - Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ù‚Ø¯Ø± Ø§Ù„Ø¥Ù…ÙƒØ§Ù† ===== */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--darker-bg);
  padding: 10px 15px;
  color: var(--light-text);
  position: fixed;
  top: 0;
  right: 0;
  left: 0;
  z-index: 1000;
  border-bottom: 3px solid var(--main-color); /* Ø®Ø· Ø£Ø®Ø¶Ø± Ù†ÙŠÙˆÙ† */
  box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
}

.title {
  font-size: 16px;
  color: var(--accent-gold); /* Ø°Ù‡Ø¨ÙŠ Ù„Ø§ÙØª */
  font-family: 'Tajawal', sans-serif;
  font-weight: 800;
  letter-spacing: 1.5px;
}
/* ... Ø¨Ø§Ù‚ÙŠ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù€ Topbar ÙƒÙ…Ø§ Ù‡ÙŠ ... */

h1 {
  color: var(--main-color);
  text-align: center;
  font-size: 3.2rem;
  margin-bottom: 50px;
  text-shadow: 0 0 20px var(--main-color); /* Ø¸Ù„ Ù†ÙŠÙˆÙ† Ø£Ø®Ø¶Ø± Ù‚ÙˆÙŠ */
  font-family: 'Tajawal', sans-serif;
  font-weight: 900;
  letter-spacing: 3px;
}

/* ğŸš¨ Ø³ØªØ§ÙŠÙ„Ø§Øª Vue Cards Ø§Ù„Ù…Ø£Ø®ÙˆØ°Ø© Ù…Ù† lasti.html ÙˆÙ…Ø¹Ø¯Ù„Ø© Ù„Ù„Ø£Ø®Ø¶Ø± */
.glass-card {
  background: rgba(30,41,59,0.5); 
  backdrop-filter: blur(8px);
  border:1px solid rgba(255,255,255,0.03); 
  transition: all 0.3s ease;
}
.glass-card:hover {
  background: rgba(51,65,85,0.6); 
  transform: translateY(-2px);
  border-color: rgba(16,185,129,0.5); /* Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}
.animate-fade-in { animation: fadeIn 0.4s ease-out; }
@keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
.loading-dialog {
  position: fixed;
  inset: 0;
  z-index: 50;
  background: rgba(0,0,0,0.7);
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  color:white;
}

/* ğŸš¨ Toast Ø§Ù„Ø£ØµÙ„ÙŠ Ù…Ù† subjects.html */
#toast {
  visibility: hidden;
  min-width: 300px;
  background: var(--darker-bg);
  color: var(--accent-gold);
  text-align: center;
  border-radius: 18px;
  padding: 18px;
  position: fixed;
  z-index: 2000;
  left: 50%;
  bottom: 30px;
  transform: translateX(-50%);
  font-size: 1.2rem;
  border: 2px solid var(--light-color); /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ */
  box-shadow: 0 0 15px var(--light-color), 0 8px 25px rgba(0,0,0,0.8);
  opacity: 0;
  transition: opacity 0.5s, bottom 0.5s;
}
#toast.show {
  visibility: visible;
  opacity: 1;
  bottom: 50px;
}

/* âœ… Ø²Ø± Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø¦Ù… */
.profile-float-btn {
  position: fixed;
  bottom: 30px;
  left: 30px;
  width: 65px;
  height: 65px;
  border-radius: 50%;
  background: var(--darker-bg);
  border: 3px solid var(--accent-gold);
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 0 15px var(--accent-gold);
  transition: 0.3s;
  z-index: 1200;
}
.profile-float-btn:hover {
  transform: scale(1.15) rotate(5deg);
  background: var(--main-color); /* Ø£Ø®Ø¶Ø± */
  box-shadow: 0 0 25px var(--main-color); 
}
.profile-float-btn img {
    width: 32px;
    height: 32px;
    filter: invert(1);
}

/* ğŸš¨ Toast Ø§Ù„Ù…Ø®ØµØµØ© Ù…Ù† subjects.html Ù„Ù„Ù€ Success/Error */
.custom-toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  padding: 14px 22px;
  border-radius: 14px;
  font-family: "Cairo", sans-serif;
  font-weight: 600;
  font-size: 15px;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 10px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
  animation: slideIn 0.5s ease, fadeOut 0.5s ease 2.5s forwards;
  z-index: 9999;
}
.custom-toast.info { background: linear-gradient(135deg,#3498db,#2980b9); }
.custom-toast.success { background: linear-gradient(135deg,#10b981,#059669); } /* ğŸŸ¢ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„Ø£Ø®Ø¶Ø± */
.custom-toast.error { background: linear-gradient(135deg,#e74c3c,#c0392b); }
@keyframes slideIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
@keyframes fadeOut { to { opacity: 0; transform: translateX(120%); } }

/* ğŸš¨ Ø³ØªØ§ÙŠÙ„ ØªØ­Ø°ÙŠØ± Ø§Ù„Ù€ Fallback */
.warning-message {
    padding: 1rem;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 0.75rem;
    border: 1px solid rgba(16, 185, 129, 0.3);
    color: #10b981;
    font-weight: 600;
    margin-bottom: 1.5rem;
    text-align: center;
}
</style>
</head>

<body class="flex-col h-screen overflow-hidden">

  <div class="topbar">
    <div class="title">hacked by 1383</div>
    <div class="icons">
      <div class="toggle-dark" id="darkToggle"></div>
      <a href="" target="_blank">
        <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="WhatsApp">
      </a>
      <img id="shareBtn" src="https://cdn-icons-png.flaticon.com/512/929/929610.png" alt="Share">
      <img id="notifyBtn" src="https://cdn-icons-png.flaticon.com/512/1827/1827272.png" alt="Notification">
    </div>
  </div>

  <div id="toast">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù‡ØªØªÙØ¹Ù„ Ù‚Ø±ÙŠØ¨Ù‹Ø§ ğŸ””âœ¨</div>

  <h1> SUBJECTS 2026 </h1>

  <div id="app" class="flex-1 flex flex-col w-full max-w-7xl overflow-hidden p-0">
    
    <div v-if="loading" class="loading-dialog animate-fade-in">
        <i class="ph ph-spinner animate-spin text-5xl mb-4 text-primary"></i>
        <p class="text-lg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠØ§ Ø¨ÙˆØ¨...</p>
    </div>

    <main v-if="!loading" class="flex-1 overflow-y-auto px-4 pb-12">
        <div v-if="showFallbackWarning" class="warning-message animate-fade-in">
            âš ï¸ **Ù…Ù„Ø­ÙˆØ¸Ø©:** Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¯ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù€ "{{ userData.section }}" (ÙŠØªÙ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ù†ÙˆØ§Øª ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø©).
        </div>

        <div v-if="stage===0" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <div v-for="year in filteredData" :key="year.id" @click="selectYear(year)"
                class="glass-card rounded-xl p-5 cursor-pointer group relative overflow-hidden animate-fade-in hover:scale-105 transition-transform duration-200 text-center">
                <div class="w-full h-32 bg-slate-800 rounded-xl mb-3 flex items-center justify-center overflow-hidden mx-auto">
                    <i class="ph ph-calendar-blank text-5xl text-primary/50" v-if="!year.image_url"></i>
                    <img v-else :src="year.image_url" class="w-full h-full object-cover">
                </div>
                
                <h3 class="font-bold text-lg text-gray-200 group-hover:text-primary transition-colors">{{ year.name }}</h3>
                <span class="text-sm text-gray-400">{{ year.subjects?.length || 0 }} Ù…Ø§Ø¯Ø©</span>
            </div>
        </div>

        <div v-if="stage===1" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <button @click="stage=0" class="glass-card rounded-xl p-5 cursor-pointer flex flex-col items-center justify-center group relative overflow-hidden animate-fade-in hover:scale-105 transition-transform duration-200 h-full text-center">
                <i class="ph ph-arrow-right text-3xl text-gray-400 group-hover:text-primary mb-2"></i>
                <span class="font-bold text-md text-gray-200 group-hover:text-primary transition-colors">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø³Ù†ÙˆØ§Øª</span>
            </button>
            <div v-for="subject in selectedYear.subjects" :key="subject.id" @click="selectSubject(subject)"
                class="glass-card rounded-xl p-5 cursor-pointer group relative overflow-hidden animate-fade-in hover:scale-105 transition-transform duration-200 text-center">
                <div class="w-full h-32 bg-slate-800 rounded-xl mb-3 flex items-center justify-center overflow-hidden mx-auto">
                    <i class="ph ph-book-open text-5xl text-primary/50" v-if="!subject.image_url"></i>
                    <img v-else :src="subject.image_url" class="w-full h-full object-cover">
                </div>

                <h3 class="font-bold text-lg text-gray-200 group-hover:text-primary transition-colors">{{ subject.name }}</h3>
                <span class="text-sm text-gray-400">{{ subject.teachers?.length || 0 }} Ù…ÙØ¯Ø±Ø³</span>
            </div>
        </div>

        <div v-if="stage > 1" class="p-6 text-center text-gray-500">
          <p>âš ï¸ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø´ Ù…Ø­ØªØ§Ø¬ ÙŠØªØ¹Ø±Ø¶ Ù‡Ù†Ø§ (Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†/Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª).</p>
          <button @click="stage=1" class="mt-4 p-2 text-sm text-primary hover:text-white">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ÙˆØ§Ø¯</button>
        </div>
    </main>

    <div class="fixed bottom-4 right-4 flex flex-col gap-2 z-50">
      <transition-group name="toast" tag="div">
        <div v-for="toast in toasts" :key="toast.id" :class="['custom-toast', toast.type]" :style="{ animationDuration: '3s' }">{{ toast.message }}</div>
      </transition-group>
    </div>
  </div>
  <a href="profile.html" class="profile-float-btn">
    <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Ø¨Ø±ÙˆÙØ§ÙŠÙ„">
  </a>

<script type="module">
const { createApp, ref, computed } = Vue;

// ğŸ’¡ Ø¯Ø§Ù„Ø© Toast Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù€ Vue
function createVueToastFunction(toastsRef) {
    return (message, type='info', duration=3000) => {
        const id = Date.now() + Math.random();
        toastsRef.value.push({ id, message, type });
        setTimeout(() => {
            const index = toastsRef.value.findIndex(t => t.id === id);
            if(index !== -1) toastsRef.value.splice(index,1);
        }, duration);
    };
}

// ğŸ’¡ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø®ØµØµØ© ÙÙŠ subjects.html
function showOriginalToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.className = "show";
  setTimeout(() => toast.className = toast.className.replace("show", ""), 3000);
}


document.addEventListener("authReady", () => {
    // ğŸš¨ ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Vue App ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Firebase
    
    createApp({
      setup() {
        const data = ref([]);
        const userData = ref(getUserData()); 
        const stage = ref(0); 
        const selectedYear = ref({});
        const selectedSubject = ref({});
        const loading = ref(true);
        const showFallbackWarning = ref(false); 

        // Toasts
        const toasts = ref([]);
        const showToast = createVueToastFunction(toasts);

        const selectYear = (year) => { selectedYear.value=year; stage.value=1; }
        
        // ğŸ’¡ ÙØªØ­ ØµÙØ­Ø© teachers.html Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø§Ø¯Ø©
        const selectSubject = (subject) => { 
            selectedSubject.value = subject;
            window.location.href = `teachers.html?year=${encodeURIComponent(selectedYear.value.name)}&subject=${encodeURIComponent(subject.name)}`;
        }

        // Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© (Fallback Logic) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø´Ø¹Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const filteredData = computed(() => {
          let currentData = data.value;
          const section = userData.value.section.trim().toLowerCase();
          
          let sectionFiltered = [];
          const validSections = ["Ø¹Ù„Ù…ÙŠ Ø¹Ù„ÙˆÙ…", "Ø¹Ù„Ù…ÙŠ Ø±ÙŠØ§Ø¶Ø©", "Ø£Ø¯Ø¨ÙŠ"].map(s => s.toLowerCase());

          if (validSections.includes(section)) {
             sectionFiltered = currentData.filter(year => year.name.toLowerCase().includes(section));
          }
          
          if (sectionFiltered.length === 0) {
            showFallbackWarning.value = true;
            currentData = data.value;
          } else {
            showFallbackWarning.value = false;
            currentData = sectionFiltered;
          }
          
          return currentData;
        });

        // ğŸŒ Ø§Ù„Ù„ÙŠÙ†Ùƒ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯
        const DATA_SOURCE_URL = "https://plus-teal.vercel.app/organized_output.json";

        fetch(DATA_SOURCE_URL)
          .then(res => res.json())
          .then(json => { 
              data.value = json; 
              loading.value = false; 
              showToast(`âœ… Ø£Ù‡Ù„Ø§Ù‹ ÙŠØ§ ${userData.value.name}! ØªÙ… ØªØ­Ù…ÙŠÙ„ ${data.value.length} Ø³Ù†Ø© Ø¯Ø±Ø§Ø³ÙŠØ©.`, "success"); 
          })
          .catch(err => { 
              console.error(err); 
              loading.value=false; 
              showToast("âš  ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù„ÙŠÙ†Ùƒ.", "error"); 
          });

        return { 
            data, stage, selectedYear, selectedSubject, loading, 
            filteredData, userData, showFallbackWarning,
            toasts, selectYear, selectSubject
        }
      }
    }).mount('#app');
    
    // ğŸš¨ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Listeners Ø§Ù„Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù‚Ù‚

    // ğŸŒ“ ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±/Ø§Ù„Ù„ÙŠÙ„
    const toggle = document.getElementById("darkToggle");
    toggle.addEventListener("click", () => {
      toggle.classList.toggle("active");
      document.body.classList.toggle("light-mode");
    });

    // ğŸ“¤ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
    document.getElementById("shareBtn").addEventListener("click", async () => {
      if (navigator.share) {
        try {
          await navigator.share({
            title: "ØªØ·Ø¨ÙŠÙ‚ 1383",
            text: "Ø¬Ø±Ø¨ ØªØ·Ø¨ÙŠÙ‚ 1383 2026 ğŸ“šâœ¨",
            url: window.location.href
          });
        } catch {
          showOriginalToast("âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©");
        }
      } else {
        showOriginalToast("Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù…ØªØµÙØ­Ùƒ ğŸ˜¢");
      }
    });

    // ğŸ”” Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    document.getElementById("notifyBtn").addEventListener("click", () => {
      showOriginalToast("Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù‡ØªØªÙØ¹Ù„ Ù‚Ø±ÙŠØ¨Ù‹Ø§ ğŸ””âœ¨");
    });
});
</script>

</body>
</html>
